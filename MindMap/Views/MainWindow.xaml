<Window x:Class="MindMap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:MindMap.Views"
        xmlns:vm="clr-namespace:MindMap.ViewModels"
        Title="Mind Map" Height="800" Width="1200">
    <Window.InputBindings>
        <KeyBinding Key="Tab" Command="{Binding AddChildCommand}" />
        <KeyBinding Key="Enter" Command="{Binding AddSiblingCommand}" />
        <KeyBinding Key="Back" Command="{Binding DeleteNodeCommand}" />
        <KeyBinding Key="Left" Command="{Binding MoveSelectionLeftCommand}" />
        <KeyBinding Key="Right" Command="{Binding MoveSelectionRightCommand}" />
        <KeyBinding Key="Up" Command="{Binding MoveSelectionUpCommand}" />
        <KeyBinding Key="Down" Command="{Binding MoveSelectionDownCommand}" />
        <KeyBinding Key="Up" Modifiers="Control" Command="{Binding MoveNodeUpCommand}" />
        <KeyBinding Key="Down" Modifiers="Control" Command="{Binding MoveNodeDownCommand}" />
        <KeyBinding Key="Left" Modifiers="Control" Command="{Binding MoveNodeLeftCommand}" />
        <KeyBinding Key="Right" Modifiers="Control" Command="{Binding MoveNodeRightCommand}" />
    </Window.InputBindings>
    <Canvas x:Name="MindMapCanvas" Background="#455A65">
        <!-- Branches 먼저 -->
        <ItemsControl ItemsSource="{Binding Arrows}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type vm:MindMapArrowViewModel}">
                    <local:BranchControl
                    StartPoint="{Binding StartPoint}"
                    EndPoint="{Binding EndPoint}" />
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Nodes -->
        <ItemsControl ItemsSource="{Binding Nodes}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemContainerStyle>
                <Style>
                    <Setter Property="Canvas.Left" Value="{Binding Position.X}" />
                    <Setter Property="Canvas.Top" Value="{Binding Position.Y}" />
                </Style>
            </ItemsControl.ItemContainerStyle>

            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type vm:MindMapNodeViewModel}">
                    <local:NodeControl/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Canvas>
</Window>